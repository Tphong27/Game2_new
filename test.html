<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Game - ƒê∆Ø·ªúNG ƒêUA N∆Ø·ªöC</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .test-panel {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.9);
        padding: 20px;
        border-radius: 10px;
        z-index: 2000;
        max-width: 350px;
        max-height: 90vh;
        overflow-y: auto;
      }
      .test-panel h3 {
        color: #f1c40f;
        margin-bottom: 15px;
      }
      .test-btn {
        display: block;
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
      }
      .test-btn:hover {
        background: #2980b9;
      }
      .test-btn.success {
        background: #27ae60;
      }
      .test-btn.danger {
        background: #e74c3c;
      }
      .test-btn.warning {
        background: #f39c12;
      }
      .test-log {
        background: #1a1a2e;
        padding: 10px;
        border-radius: 5px;
        margin-top: 15px;
        max-height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 0.8em;
      }
      .test-log .info {
        color: #3498db;
      }
      .test-log .success {
        color: #27ae60;
      }
      .test-log .error {
        color: #e74c3c;
      }
      .test-log .warn {
        color: #f39c12;
      }
      .test-section {
        border-top: 1px solid #444;
        padding-top: 10px;
        margin-top: 10px;
      }
      .test-section h4 {
        color: #aaa;
        font-size: 0.9em;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1><span class="water-emoji">üåä</span> TEST MODE <span>üß™</span></h1>
        <p>Ki·ªÉm tra c√°c ch·ª©c nƒÉng c·ªßa game</p>
      </header>
    </div>

    <!-- Question Modal (copy t·ª´ index.html) -->
    <div id="questionModal" class="modal">
      <div class="modal-content">
        <h2 id="modalTitle">
          ‚ùì C√¢u h·ªèi cho nh√≥m <span id="questionTeam">1</span>
        </h2>
        <span id="difficultyBadge" class="difficulty-badge"></span>
        <div class="timer" id="timerDisplay">
          ‚è±Ô∏è <span id="timeLeft">7</span>s
        </div>
        <div id="questionContent">
          <!-- Question content goes here -->
        </div>
      </div>
    </div>

    <!-- Test Panel -->
    <div class="test-panel">
      <h3>üß™ Test Panel</h3>

      <div class="test-section">
        <h4>üìã Timer Tests</h4>
        <button class="test-btn" onclick="testTimerEasy()">
          Test Timer D·ªÑ (7s)
        </button>
        <button class="test-btn" onclick="testTimerMedium()">
          Test Timer KH√ì (10s)
        </button>
        <button class="test-btn" onclick="testTimerHard()">
          Test Timer R·∫§T KH√ì (15s)
        </button>
        <button class="test-btn warning" onclick="testTimerExpireAndNew()">
          Test H·∫øt gi·ªù ‚Üí C√¢u m·ªõi
        </button>
      </div>

      <div class="test-section">
        <h4>‚úÖ Answer Display Tests</h4>
        <button class="test-btn success" onclick="testCorrectAnswer()">
          Test ƒê√°p √°n ƒê√öNG
        </button>
        <button class="test-btn danger" onclick="testWrongAnswer()">
          Test ƒê√°p √°n SAI
        </button>
        <button class="test-btn" onclick="testTrueFalseCorrect()">
          Test ƒê√∫ng/Sai - ƒê√∫ng
        </button>
        <button class="test-btn" onclick="testTrueFalseWrong()">
          Test ƒê√∫ng/Sai - Sai
        </button>
      </div>

      <div class="test-section">
        <h4>üìê Layout Tests</h4>
        <button class="test-btn" onclick="testLongExplanation()">
          Test Gi·∫£i th√≠ch D√ÄI
        </button>
        <button class="test-btn" onclick="testLongQuestion()">
          Test C√¢u h·ªèi D√ÄI
        </button>
        <button class="test-btn" onclick="testModalCenter()">
          Test Modal cƒÉn gi·ªØa
        </button>
      </div>

      <div class="test-section">
        <h4>üîÑ Scenario Tests</h4>
        <button class="test-btn warning" onclick="testFullFlow()">
          Test lu·ªìng ƒë·∫ßy ƒë·ªß
        </button>
        <button class="test-btn" onclick="closeModal()">ƒê√≥ng Modal</button>
        <button class="test-btn danger" onclick="clearLog()">X√≥a Log</button>
      </div>

      <div class="test-log" id="testLog">
        <div class="info">üöÄ Test panel ready...</div>
      </div>
    </div>

    <script src="questions.js"></script>
    <script>
      // ========== TEST UTILITIES ==========
      function log(msg, type = "info") {
        const logDiv = document.getElementById("testLog");
        const time = new Date().toLocaleTimeString();
        logDiv.innerHTML += `<div class="${type}">[${time}] ${msg}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function clearLog() {
        document.getElementById("testLog").innerHTML =
          '<div class="info">üßπ Log cleared</div>';
      }

      // ========== MOCK GAME STATE ==========
      let gameState = {
        currentQuestion: null,
        currentDifficulty: null,
        timeExpired: false,
        timerInterval: null,
        timeLeft: 0,
        scores: { 1: 0 },
      };

      // ========== TIMER FUNCTIONS (copy t·ª´ index.html) ==========
      function startTimer(difficulty) {
        if (gameState.timerInterval) {
          clearInterval(gameState.timerInterval);
        }

        const timeByDifficulty = { easy: 7, medium: 10, hard: 15 };
        gameState.timeLeft = timeByDifficulty[difficulty];

        const timerDisplay = document.getElementById("timerDisplay");

        // Reset timer display HTML
        timerDisplay.innerHTML = `‚è±Ô∏è <span id="timeLeft">${gameState.timeLeft}</span>s`;
        timerDisplay.classList.remove("warning");

        log(`Timer started: ${gameState.timeLeft}s (${difficulty})`, "info");

        gameState.timerInterval = setInterval(() => {
          gameState.timeLeft--;
          const timeLeftSpan = document.getElementById("timeLeft");
          if (timeLeftSpan) {
            timeLeftSpan.textContent = gameState.timeLeft;
          }

          if (gameState.timeLeft <= 3) {
            timerDisplay.classList.add("warning");
          }

          if (gameState.timeLeft <= 0) {
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
            timeOut();
          }
        }, 1000);
      }

      function stopTimer() {
        if (gameState.timerInterval) {
          clearInterval(gameState.timerInterval);
          gameState.timerInterval = null;
          log("Timer stopped", "info");
        }
      }

      function timeOut() {
        const timerDisplay = document.getElementById("timerDisplay");
        timerDisplay.innerHTML =
          '<span style="color: #ef4444; font-weight: bold;">‚è∞ H·∫æT GI·ªú - H√£y ch·ªçn ƒë√°p √°n!</span>';
        gameState.timeExpired = true;
        log("‚è∞ Time expired!", "warn");
      }

      // ========== QUESTION DISPLAY FUNCTIONS ==========
      function showQuestion(question, difficulty) {
        gameState.currentQuestion = question;
        gameState.currentDifficulty = difficulty;
        gameState.timeExpired = false;

        const modal = document.getElementById("questionModal");
        const badge = document.getElementById("difficultyBadge");
        const content = document.getElementById("questionContent");

        const difficultyLabels = { easy: "D·ªÑ", medium: "KH√ì", hard: "R·∫§T KH√ì" };
        badge.textContent = difficultyLabels[difficulty];
        badge.className = `difficulty-badge difficulty-${difficulty}`;

        content.innerHTML = renderQuestionContent(question);
        modal.classList.add("active");

        startTimer(difficulty);
        log(
          `Question displayed: ${question.question.substring(0, 50)}...`,
          "info",
        );
      }

      function renderQuestionContent(question) {
        let html = `<div class="question-text">${question.question}</div>`;
        html += `<div class="answers-container">`;

        if (question.type === "trueFalse") {
          html += `
                    <button class="btn btn-answer btn-true" onclick="submitAnswer(true)">‚úì ƒê√öNG</button>
                    <button class="btn btn-answer btn-false" onclick="submitAnswer(false)">‚úó SAI</button>
                `;
        } else if (question.type === "multipleChoice") {
          question.options.forEach((option) => {
            const letter = option.charAt(0);
            html += `<button class="btn btn-answer" onclick="submitAnswer('${letter}')">${option}</button>`;
          });
        }

        html += `</div>`;
        html += `<div id="resultArea"></div>`;
        return html;
      }

      function submitAnswer(answer) {
        stopTimer();

        const question = gameState.currentQuestion;
        let isCorrect = false;

        if (question.type === "trueFalse") {
          isCorrect = answer === question.answer;
        } else if (question.type === "multipleChoice") {
          isCorrect = answer === question.answer;
        }

        log(
          `Answer submitted: ${answer}, Correct: ${isCorrect}`,
          isCorrect ? "success" : "error",
        );
        showResult(isCorrect, question.explanation);
      }

      function showResult(isCorrect, explanation) {
        stopTimer();

        const resultArea = document.getElementById("resultArea");
        const question = gameState.currentQuestion;

        let correctAnswerText = "";
        if (question.type === "trueFalse") {
          correctAnswerText = question.answer ? "ƒê√öNG" : "SAI";
        } else if (question.type === "multipleChoice") {
          const correctOption = question.options.find(
            (opt) => opt.charAt(0) === question.answer,
          );
          correctAnswerText = correctOption || question.answer;
        }

        let resultMessage = isCorrect ? "‚úÖ CH√çNH X√ÅC!" : "‚ùå SAI R·ªíI!";
        let answerLine = isCorrect
          ? `<p><strong>üìå ƒê√°p √°n:</strong> ${correctAnswerText}</p>`
          : `<p><strong>üìå ƒê√°p √°n ƒë√∫ng l√†:</strong> ${correctAnswerText}</p>`;

        resultArea.innerHTML = `
                <div class="result-display ${isCorrect ? "result-correct" : "result-wrong"}">
                    ${resultMessage}
                </div>
                <div class="answer-reveal">
                    ${answerLine}
                    <h4>üìñ Gi·∫£i th√≠ch:</h4> ${explanation || "Kh√¥ng c√≥ gi·∫£i th√≠ch."}
                </div>
                <button class="btn btn-primary" onclick="closeModal()" style="margin-top: 12px; padding: 10px 25px;">
                    ‚û°Ô∏è TI·∫æP T·ª§C
                </button>
            `;

        log("Result displayed", "success");
      }

      function closeModal() {
        stopTimer();
        document.getElementById("questionModal").classList.remove("active");
        log("Modal closed", "info");
      }

      // ========== TEST FUNCTIONS ==========

      // Timer Tests
      function testTimerEasy() {
        log("--- TEST: Timer Easy ---", "info");
        const q = questions.easy[0];
        showQuestion(q, "easy");
      }

      function testTimerMedium() {
        log("--- TEST: Timer Medium ---", "info");
        const q = questions.medium[0];
        showQuestion(q, "medium");
      }

      function testTimerHard() {
        log("--- TEST: Timer Hard ---", "info");
        const q = questions.hard[0];
        showQuestion(q, "hard");
      }

      function testTimerExpireAndNew() {
        log("--- TEST: Timer Expire then New Question ---", "info");
        log("Step 1: Showing question with 3s timer...", "warn");

        const q1 = questions.easy[0];
        gameState.currentQuestion = q1;
        gameState.currentDifficulty = "easy";

        const modal = document.getElementById("questionModal");
        const badge = document.getElementById("difficultyBadge");
        const content = document.getElementById("questionContent");

        badge.textContent = "TEST";
        badge.className = "difficulty-badge difficulty-easy";
        content.innerHTML = renderQuestionContent(q1);
        modal.classList.add("active");

        // Start with 3s timer for quick test
        if (gameState.timerInterval) clearInterval(gameState.timerInterval);
        gameState.timeLeft = 3;

        const timerDisplay = document.getElementById("timerDisplay");
        timerDisplay.innerHTML = `‚è±Ô∏è <span id="timeLeft">3</span>s`;
        timerDisplay.classList.add("warning");

        gameState.timerInterval = setInterval(() => {
          gameState.timeLeft--;
          const timeLeftSpan = document.getElementById("timeLeft");
          if (timeLeftSpan) timeLeftSpan.textContent = gameState.timeLeft;

          if (gameState.timeLeft <= 0) {
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
            timeOut();

            log(
              "Step 2: Timer expired! Waiting 2s then showing new question...",
              "warn",
            );

            setTimeout(() => {
              log("Step 3: Showing NEW question with fresh timer...", "info");
              const q2 = questions.easy[1] || questions.easy[0];
              showQuestion(q2, "easy");

              // Verify timer is working
              setTimeout(() => {
                const span = document.getElementById("timeLeft");
                if (span && !isNaN(parseInt(span.textContent))) {
                  log(
                    `‚úÖ PASS: Timer is working! Current: ${span.textContent}s`,
                    "success",
                  );
                } else {
                  log("‚ùå FAIL: Timer not working properly!", "error");
                }
              }, 1500);
            }, 2000);
          }
        }, 1000);
      }

      // Answer Display Tests
      function testCorrectAnswer() {
        log("--- TEST: Correct Answer (Multiple Choice) ---", "info");
        const q = {
          type: "multipleChoice",
          question: "ƒê√¢y l√† c√¢u h·ªèi test tr·∫Øc nghi·ªám?",
          options: [
            "A. ƒê√°p √°n A",
            "B. ƒê√°p √°n B (ƒë√∫ng)",
            "C. ƒê√°p √°n C",
            "D. ƒê√°p √°n D",
          ],
          answer: "B",
          explanation: "ƒê√¢y l√† gi·∫£i th√≠ch cho ƒë√°p √°n ƒë√∫ng B.",
        };
        showQuestion(q, "easy");

        setTimeout(() => {
          submitAnswer("B"); // Correct
        }, 500);
      }

      function testWrongAnswer() {
        log("--- TEST: Wrong Answer (Multiple Choice) ---", "info");
        const q = {
          type: "multipleChoice",
          question: "ƒê√¢y l√† c√¢u h·ªèi test tr·∫Øc nghi·ªám?",
          options: [
            "A. ƒê√°p √°n A",
            "B. ƒê√°p √°n B (ƒë√∫ng)",
            "C. ƒê√°p √°n C",
            "D. ƒê√°p √°n D",
          ],
          answer: "B",
          explanation: "ƒê√¢y l√† gi·∫£i th√≠ch. ƒê√°p √°n ƒë√∫ng l√† B v√¨ l√Ω do XYZ.",
        };
        showQuestion(q, "easy");

        setTimeout(() => {
          submitAnswer("A"); // Wrong
        }, 500);
      }

      function testTrueFalseCorrect() {
        log("--- TEST: True/False - Correct ---", "info");
        const q = {
          type: "trueFalse",
          question: "Tr√°i ƒë·∫•t quay quanh m·∫∑t tr·ªùi?",
          answer: true,
          explanation: "Tr√°i ƒë·∫•t quay quanh m·∫∑t tr·ªùi trong kho·∫£ng 365 ng√†y.",
        };
        showQuestion(q, "easy");

        setTimeout(() => {
          submitAnswer(true); // Correct
        }, 500);
      }

      function testTrueFalseWrong() {
        log("--- TEST: True/False - Wrong ---", "info");
        const q = {
          type: "trueFalse",
          question: "M·∫∑t trƒÉng l√† m·ªôt ng√¥i sao?",
          answer: false,
          explanation:
            "M·∫∑t trƒÉng l√† v·ªá tinh t·ª± nhi√™n c·ªßa Tr√°i ƒê·∫•t, kh√¥ng ph·∫£i ng√¥i sao.",
        };
        showQuestion(q, "easy");

        setTimeout(() => {
          submitAnswer(true); // Wrong (answer is false)
        }, 500);
      }

      // Layout Tests
      function testLongExplanation() {
        log("--- TEST: Long Explanation ---", "info");
        const q = {
          type: "multipleChoice",
          question: "C√¢u h·ªèi ng·∫Øn?",
          options: ["A. ƒê√°p √°n A", "B. ƒê√°p √°n B", "C. ƒê√°p √°n C", "D. ƒê√°p √°n D"],
          answer: "B",
          explanation:
            "ƒê√¢y l√† m·ªôt gi·∫£i th√≠ch r·∫•t d√†i ƒë·ªÉ test xem c√≥ b·ªã tr√†n khung kh√¥ng. " +
            "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. " +
            "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. " +
            "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. " +
            "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. " +
            "Th√™m m·ªôt ƒëo·∫°n text ti·∫øng Vi·ªát d√†i n·ªØa ƒë·ªÉ ki·ªÉm tra vi·ªác xu·ªëng d√≤ng v√† hi·ªÉn th·ªã ƒë√∫ng c√°ch trong khung gi·∫£i th√≠ch.",
        };
        showQuestion(q, "medium");

        setTimeout(() => submitAnswer("A"), 500);
      }

      function testLongQuestion() {
        log("--- TEST: Long Question ---", "info");
        const q = {
          type: "multipleChoice",
          question:
            "ƒê√¢y l√† m·ªôt c√¢u h·ªèi r·∫•t d√†i ƒë·ªÉ test xem modal c√≥ hi·ªÉn th·ªã ƒë√∫ng kh√¥ng? " +
            "C√¢u h·ªèi n√†y c√≥ th·ªÉ ch·ª©a r·∫•t nhi·ªÅu n·ªôi dung, bao g·ªìm c·∫£ c√°c thu·∫≠t ng·ªØ chuy√™n ng√†nh, " +
            "c√°c kh√°i ni·ªám ph·ª©c t·∫°p v·ªÅ tri·∫øt h·ªçc, v≈© tr·ª• quan, v√† h√¨nh th√°i √Ω th·ª©c. " +
            "Ng∆∞·ªùi ch∆°i c·∫ßn ƒë·ªçc k·ªπ c√¢u h·ªèi tr∆∞·ªõc khi tr·∫£ l·ªùi.",
          options: [
            "A. ƒê√°p √°n A v·ªõi n·ªôi dung kh√° d√†i ƒë·ªÉ test",
            "B. ƒê√°p √°n B c≈©ng c√≥ n·ªôi dung d√†i t∆∞∆°ng t·ª±",
            "C. ƒê√°p √°n C ng·∫Øn h∆°n",
            "D. ƒê√°p √°n D",
          ],
          answer: "A",
          explanation: "Gi·∫£i th√≠ch ng·∫Øn g·ªçn.",
        };
        showQuestion(q, "hard");
      }

      function testModalCenter() {
        log("--- TEST: Modal Center Position ---", "info");
        const q = questions.easy[0];
        showQuestion(q, "easy");

        setTimeout(() => {
          const modal = document.querySelector("#questionModal .modal-content");
          const rect = modal.getBoundingClientRect();
          const windowWidth = window.innerWidth;
          const windowHeight = window.innerHeight;

          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;

          const isHorizontalCenter = Math.abs(centerX - windowWidth / 2) < 50;
          const isVerticalCenter = Math.abs(centerY - windowHeight / 2) < 100;

          if (isHorizontalCenter && isVerticalCenter) {
            log(
              `‚úÖ PASS: Modal is centered! (${Math.round(centerX)}, ${Math.round(centerY)})`,
              "success",
            );
          } else {
            log(
              `‚ùå FAIL: Modal not centered. Center: (${Math.round(centerX)}, ${Math.round(centerY)}), Expected: (${Math.round(windowWidth / 2)}, ${Math.round(windowHeight / 2)})`,
              "error",
            );
          }
        }, 100);
      }

      // Full Flow Test
      function testFullFlow() {
        log("--- TEST: Full Flow ---", "info");
        log("Testing complete question ‚Üí answer ‚Üí result flow...", "info");

        // Test 1: Show question
        const q = questions.medium[0] || {
          type: "multipleChoice",
          question: "Test question?",
          options: ["A. Option A", "B. Option B", "C. Option C", "D. Option D"],
          answer: "B",
          explanation: "Test explanation.",
        };

        showQuestion(q, "medium");
        log("‚úÖ Question displayed", "success");

        // Test 2: Verify timer started
        setTimeout(() => {
          const timeSpan = document.getElementById("timeLeft");
          if (timeSpan && parseInt(timeSpan.textContent) > 0) {
            log("‚úÖ Timer is running", "success");
          } else {
            log("‚ùå Timer issue detected", "error");
          }
        }, 500);

        // Test 3: Submit answer and check result
        setTimeout(() => {
          submitAnswer(q.answer);

          setTimeout(() => {
            const resultArea = document.getElementById("resultArea");
            if (resultArea.innerHTML.includes("CH√çNH X√ÅC")) {
              log("‚úÖ Correct answer displayed properly", "success");
            }
            if (resultArea.innerHTML.includes("ƒê√°p √°n:")) {
              log("‚úÖ Answer line displayed", "success");
            }
            if (resultArea.innerHTML.includes("Gi·∫£i th√≠ch:")) {
              log("‚úÖ Explanation displayed", "success");
            }

            log("üéâ Full flow test completed!", "success");
          }, 300);
        }, 1500);
      }

      // Initialize
      log("Test page loaded. Click buttons to run tests.", "success");
    </script>
  </body>
</html>
